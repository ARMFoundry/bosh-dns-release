---
name: dns

templates:
  aliases.json.erb: dns/aliases.json
  dns_ctl.erb: bin/dns_ctl
  dns_resolvconf_ctl.erb: bin/dns_resolvconf_ctl
  dns_healthcheck_ctl.erb: bin/dns_healthcheck_ctl
  post-start.erb: bin/post-start
  config.json.erb: config/config.json
  healthcheck_server_config.json.erb: config/healthcheck_server_config.json
  server.key.erb: config/certs/server.key
  server.pem.erb: config/certs/server.pem
  client.key.erb: config/certs/client.key
  client.pem.erb: config/certs/client.pem
  ca.pem.erb:     config/certs/ca.pem

packages:
  - dns

properties:
  address:
    description: "Address in which the DNS server will bind"
    default: 169.254.0.2
  aliased_address:
    description: "Address that will be added by default"
    default: 169.254.0.2
  port:
    description: "Port that the DNS server will bind to"
    default: 53

  records_file:
    description: "Path to the file containing information that the DNS server will use to create DNS records"
    default: /var/vcap/instance/dns/records.json

  aliases:
    description: "Hash of domain key to target domains array for aliased DNS lookups"
    example:
      cc.cf.consul: [ one, two, ... ]
      third.internal: [ four ]
  alias_files_glob:
    description: "Glob for any files to look for DNS alias information"
    default: /var/vcap/jobs/*/dns/aliases.json

  override_nameserver:
    description: "Configure ourselves as the system nameserver (e.g. /etc/resolv.conf will be watched and overwritten)"
    default: true

  recursors:
    description: "Addresses of upstream DNS servers used for recursively resolving queries"
    default: []
  recursor_timeout:
    description: "A timeout value for when dialing, writing and reading from the configured recursors"
    default: 2s

  healthcheck_domains:
    description: "Domain names that the dns server should respond to with successful answers. Answer ip will always be 127.0.0.1"
    default:
      - healthcheck.bosh-dns.
      - consul.service.cf.internal.

  health.enabled:
    description: "Enable healthchecks for DNS resolution"
    default: false

  health.server_port:
    description: "Port to run healthchecks server on"
    default: 8080

  health.server_tls_key:
    description: "Server-side mutual TLS key for healthchecking"

  health.server_tls_cert:
    description: "Server-side mutual TLS certificate for healthchecking"

  health.client_tls_key:
    description: "Client-side mutual TLS key for healthchecking"

  health.client_tls_cert:
    description: "Client-side mutual TLS certificate for healthchecking"

  health.ca_tls_cert:
    description: "Root CA for the health service."
