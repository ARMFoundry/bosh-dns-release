<%=
handlers = p('handlers')
handlers.each do |handler|
    if handler["domain"].nil?
      raise "expected a domain for handler #{handler}"
    end
    if handler.fetch("source", {})["type"].nil?
      raise "expected a type for handler #{handler}"
    end
end

handlers = {}

if_p('handlers') do |property| handlers = property end

JSON.dump(handlers)
%>